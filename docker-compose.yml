# ============================================================
# Hytale Dedicated Server - Docker Compose
# Author: Andy (RamgeSoft)
# ============================================================
# 
# SETUP:
# 1. Kopiere HytaleServer.jar und Assets.zip in ./server/
# 2. Passe die Umgebungsvariablen unten an
# 3. Starte mit: docker-compose up -d
# 4. Logs anschauen: docker-compose logs -f
# 5. Beim ersten Start: /auth login device ausführen
#
# ============================================================

services:
  hytale:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: hytale-server
    hostname: hytale
    restart: unless-stopped
    
    # ========================================================
    # Environment Variables
    # ========================================================
    environment:
      # Java Memory Settings
      - JAVA_MIN_RAM=3G
      - JAVA_MAX_RAM=4G
      
      # Server Settings
      - SERVER_PORT=5520
      - SERVER_BIND=0.0.0.0
      
      # Backup Settings
      - ENABLE_BACKUP=true
      - BACKUP_FREQUENCY=30
      
      # Auth Mode (authenticated oder offline für LAN)
      # - AUTH_MODE=offline
      
      # Timezone
      - TZ=Europe/Berlin
      
      # User/Group IDs (match your host user for permissions)
      - PUID=1000
      - PGID=1000
    
    # ========================================================
    # Ports - WICHTIG: UDP nicht TCP!
    # ========================================================
    ports:
      - "5520:5520/udp"
    
    # ========================================================
    # Volumes
    # ========================================================
    volumes:
      # Server files (HytaleServer.jar, Assets.zip)
      - ./server:/opt/hytale/server:ro
      
      # Persistent data (worlds, configs)
      - ./data:/opt/hytale/data
      
      # Backups
      - ./backups:/opt/hytale/backups
      
      # Plugins
      - ./plugins:/opt/hytale/plugins
      
      # Mods
      - ./mods:/opt/hytale/mods
      
      # Logs
      - ./logs:/opt/hytale/logs
    
    # ========================================================
    # Stdin for console commands
    # ========================================================
    stdin_open: true
    tty: true
    
    # ========================================================
    # Resource Limits (optional - adjust as needed)
    # ========================================================
    # deploy:
    #   resources:
    #     limits:
    #       memory: 6G
    #     reservations:
    #       memory: 4G
    
    # ========================================================
    # Logging
    # ========================================================
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
    
    # ========================================================
    # Network
    # ========================================================
    networks:
      - hytale-net

# ============================================================
# Networks
# ============================================================
networks:
  hytale-net:
    driver: bridge
